<div class="container-fluid custom-padding">
    <div class="row">
        <div class="col-md-4 mx-auto">
            <div class="card">
                <div class="card-header text-center">
                    <h3>Edita Bloques</h3>
                </div>
                <div class="card-body">
                    <form action="/bloque/edit/{{bloque.id_bloque}}" method="post">
                        <div class="form-group">
                            <label for="">Nombre del Bloque</label>
                            <input type="text" value="{{bloque.nombre}}" class="form-control" id="nombre" name="nombre"
                                placeholder="Nombre Bloque" readonly>
                        </div>
                        <div class="form-group">
                            <label for="">Tipo de material</label>
                            <select class="form-control" name="tipo_material" placeholder="Tipo de material" autofocus>
                                <option value="3D" {{#if (eq bloque.tipo_material "3D" )}}selected{{/if}}>3D</option>
                                <option value="SAGEMAX" {{#if (eq bloque.tipo_material "SAGEMAX" )}}selected{{/if}}>
                                    SAGEMAX</option>
                                <option value="STC" {{#if (eq bloque.tipo_material "STC" )}}selected{{/if}}>STC</option>
                                <option value="SHTC" {{#if (eq bloque.tipo_material "SHTC" )}}selected{{/if}}>SHTC
                                </option>
                                <option value="SHTM" {{#if (eq bloque.tipo_material "SHTM" )}}selected{{/if}}>SHTM
                                </option>
                                <option value="CRCO" {{#if (eq bloque.tipo_material "CRCO" )}}selected{{/if}}>CRCO
                                </option>
                                <option value="TITAN" {{#if (eq bloque.tipo_material "TITAN" )}}selected{{/if}}>TITAN
                                </option>
                                <option value="PMMA" {{#if (eq bloque.tipo_material "PMMA" )}}selected{{/if}}>PMMA
                                </option>
                                <option value="SHOFUHC" {{#if (eq bloque.tipo_material "SHOFUHC" )}}selected{{/if}}>
                                    SHOFUHC</option>
                                <option value="PMMAML" {{#if (eq bloque.tipo_material "PMMAML" )}}selected{{/if}}>PMMA
                                    ML</option>
                                <option value="HTW" {{#if (eq bloque.tipo_material "HTW" )}}selected{{/if}}>
                                    HTW</option>
                                <option value="AIZIR" {{#if (eq bloque.tipo_material "AIZIR" )}}selected{{/if}}>AIZIR
                                </option>
                                <option value="PEEK" {{#if (eq bloque.tipo_material "PEEK" )}}selected{{/if}}>PEEK
                                </option>
                                <option value="WAX" {{#if (eq bloque.tipo_material "WAX" )}}selected{{/if}}>WAX
                                </option>
                                <option value="VEZNEER" {{#if (eq bloque.tipo_material "VEZNEER" )}}selected{{/if}}>
                                    VEZNEER
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Factor de contracción</label>
                            <input type="text" value="{{bloque.factor_contraccion}}" class="form-control"
                                id="factor_contraccion" name="factor_contraccion" placeholder="Factor de contracción">
                        </div>
                        <div class="form-group">
                            <label for="">Codigo de Barras</label>
                            <input type="text" value="{{bloque.codigo_barras}}" class="form-control" id="codigo_barras"
                                name="codigo_barras" placeholder="Codigo de barras" readonly>
                        </div>
                        <div class="form-group">
                            <label for="">Lote</label>
                            <input type="text" value="{{bloque.cantidad}}" class="form-control" name="cantidad"
                                placeholder="Lote" readonly>
                        </div>
                        <div class="form-group">
                            <label for="">Color (VITA Clásica):</label>
                            <select class="form-control" id="color" name="color" placeholder="Color (VITA Clásica):"
                                autofocus>
                                <option value="A1" {{#if (eq bloque.color "A1" )}}selected{{/if}}>A1</option>
                                <option value="A2" {{#if (eq bloque.color "A2" )}}selected{{/if}}>A2</option>
                                <option value="A3" {{#if (eq bloque.color "A3" )}}selected{{/if}}>A3</option>
                                <option value="A3.5" {{#if (eq bloque.color "A3.5" )}}selected{{/if}}>A3.5</option>
                                <option value="A4" {{#if (eq bloque.color "A4" )}}selected{{/if}}>A4</option>
                                <option value="B1" {{#if (eq bloque.color "B1" )}}selected{{/if}}>B1</option>
                                <option value="B2" {{#if (eq bloque.color "B2" )}}selected{{/if}}>B2</option>
                                <option value="B3" {{#if (eq bloque.color "B3" )}}selected{{/if}}>B3</option>
                                <option value="B4" {{#if (eq bloque.color "B4" )}}selected{{/if}}>B4</option>
                                <option value="C1" {{#if (eq bloque.color "C1" )}}selected{{/if}}>C1</option>
                                <option value="C2" {{#if (eq bloque.color "C2" )}}selected{{/if}}>C2</option>
                                <option value="C3" {{#if (eq bloque.color "C3" )}}selected{{/if}}>C3</option>
                                <option value="C4" {{#if (eq bloque.color "C4" )}}selected{{/if}}>C4</option>
                                <option value="D2" {{#if (eq bloque.color "D2" )}}selected{{/if}}>D2</option>
                                <option value="D3" {{#if (eq bloque.color "D3" )}}selected{{/if}}>D3</option>
                                <option value="D4" {{#if (eq bloque.color "D4" )}}selected{{/if}}>D4</option>
                                <option value="0M1" {{#if (eq bloque.color "0M1" )}}selected{{/if}}>0M1</option>
                                <option value="0M2" {{#if (eq bloque.color "0M2" )}}selected{{/if}}>0M2</option>
                                <option value="0M3" {{#if (eq bloque.color "0M3" )}}selected{{/if}}>0M3</option>
                                <option value="BL1" {{#if (eq bloque.color "BL1" )}}selected{{/if}}>BL1</option>
                                <option value="BL2" {{#if (eq bloque.color "BL2" )}}selected{{/if}}>BL2</option>
                                <option value="BL3" {{#if (eq bloque.color "BL3" )}}selected{{/if}}>BL3</option>
                                <option value="BL4" {{#if (eq bloque.color "BL4" )}}selected{{/if}}>BL4</option>
                                <option value="WHITE" {{#if (eq bloque.color "WHITE" )}}selected{{/if}}>WHITE</option>
                                <option value="BLANCOOPACO" {{#if (eq bloque.color "BLANCOOPACO" )}}selected{{/if}}>
                                    BLANCOOPACO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Tamaño</label>
                            <select class="form-control" name="tamano" placeholder="Tamaño" autofocus>
                                <option value="8" {{#if (eq bloque.tamano 8)}}selected{{/if}}>8</option>
                                <option value="10" {{#if (eq bloque.tamano 10)}}selected{{/if}}>10</option>
                                <option value="12" {{#if (eq bloque.tamano 12)}}selected{{/if}}>12</option>
                                <option value="14" {{#if (eq bloque.tamano 14)}}selected{{/if}}>14</option>
                                <option value="16" {{#if (eq bloque.tamano 16)}}selected{{/if}}>16</option>
                                <option value="18" {{#if (eq bloque.tamano 18)}}selected{{/if}}>18</option>
                                <option value="20" {{#if (eq bloque.tamano 20)}}selected{{/if}}>20</option>
                                <option value="22" {{#if (eq bloque.tamano 22)}}selected{{/if}}>22</option>
                                <option value="25" {{#if (eq bloque.tamano 25)}}selected{{/if}}>25</option>
                            </select>
                        </div>
                        <div class="form-group" style="display: none;">
                            <select name="id_operario" id="id_operario" class="form-control" required readonly>
                                <!-- Itera sobre el array de operarios -->
                                {{#each operarios}}
                                <option value="{{id_operario}}">{{fullname}} (ID: {{id_operario}})</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-success btn-block">
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Listas de frutas y colores aleatorios
    const frutas = [
        "MANZANA", "PLATANO", "PERA", "NARANJA", "UVA", "MELON", "SANDIA", "FRESA", "PINA", "DURAZNO",
        "MANGO", "PAPAYA", "KIWI", "CEREZA", "CIRUELA", "GRANADA", "MORA", "LIMON", "GUAYABA", "MARACUYA",
        "MANDARINA", "AGUACATE", "MAMON", "POMELO", "TAMARINDO", "ZAPOTE", "COCO", "ALMENDRA", "CASTANA",
        "NISPERO", "MAMEY", "TAMARILLO", "FEIJOA", "ANON", "ARANDANO", "CAIMITO", "JOCOTE", "LUCUMA",
        "CHONTADURO", "BOROJO", "UCHUVA", "SAPOTE", "MARANON", "COROZO", "GROSELLA", "GUANABANA",
        "GRANADILLA", "GUAMA", "CURUBA", "NANCE", "UVILLA", "HIGO", "DAMASCO", "ACEROLA", "CARAMBOLA",
        "TUMBO", "PITAYA", "GUAYUSA", "AGUAYMANTO", "MOTILON", "NARANJILLA", "PAPAYUELA", "CAMUCAMU",
        "GUARANA", "MAMONCILLO", "YACON", "LULO", "COPOAZU", "CIRIGUELO", "TUNA", "ACHOTILLO",
        "GUAVIRA", "BACABA", "QUINOTO", "PEPINODULCE", "ANACARDO", "JAMBOLAN", "HICACO", "MANGABA",
        "CHIRIMOYA", "MAMEYROJO", "PASSIFLORA", "MORICHE", "BIRIBA", "GUAIMARO", "CIRUELAAMARILLA",
        "TOTAI", "YATAY", "SAPOTILLA", "GUACIO", "TAMARIN", "POMELOROSADO", "AGUACATILLO", "GUAYURITA",
        "CEREZANEGRA", "CIRUELAVERDE", "MANGODEAGUA", "GRANADILLO", "MELONPEPINO", "BOLDO", "CAMOTILLO",
        "TAMICO", "JERGUILLO", "TUMBITA", "CAMBIURRITO", "GUAVITO", "JOCOTENEGRO", "CIRUELILLO",
        "AGUAIMANTO", "MOROCHILLO", "ARAZA", "CAFE", "TAYUYA", "MIRTOROJO", "SAPUCAIA", "MIRTONEGRO",
        "TOMATEDEARBOL", "LIMONMANDARINO", "GUABIRA", "CIRIGUELON", "MANGOBANILEJO", "GUAYABITADELPERU",
        "JURUCU", "GUAVO", "GUAPURU", "PAJURE", "PISTACHO", "COCONA", "MARASMO", "SIRIGUELA", "CHORRITO",
        "LIMONTA", "PANDANO", "PEQUI", "UBAJARA", "CHERRY", "AGUAJILLO", "MURTA", "BAGUA", "MELONAMARILLO",
        "DURIAN", "FALSAGUAYABA", "GRAVIOLA", "NUTRIA", "GUABO", "JACARANDA", "GUAVILLA", "SAFARANA",
        "TOMATESILVESTRE", "CARAMBOLAPEQUENA", "POMELODULCE", "CAJUILLO", "SANDIAAMARILLA"
    ];

    const coloresAleatorios = [
        "ROJO", "AZUL", "VERDE", "AMARILLO", "NEGRO", "ROJIZO", "ROSA", "MORADO", "NARANJA", "GRIS",
        "TURQUESA", "VIOLETA", "FUCSIA", "MARRON", "BEIGE", "CELESTE", "CORAL", "LAVANDA", "LILA",
        "AQUA", "INDIGO", "ORO", "PLATA", "BRONCE", "VERDEOLIVA", "VERDELIMA", "VERDEBOSQUE",
        "VERDEPASTO", "AZULMARINO", "AZULCLARO", "AZULTURQUESA", "AMARILLOPASTEL", "NARANJAPASTEL",
        "ROSAPALIDO", "PURPURA", "MENTA", "CAFE", "ROJOVINO", "GRISPERLA", "VERDEMUSGO",
        "AMARILLOMOSTAZA", "LIMA", "AZULELECTRICO", "CIAN", "SALMON", "CARAMELO", "ROSADO",
        "VERDEESMERALDA", "NARANJAQUEMADO", "ROSAPALO", "COBRE", "AMARILLOCANARIO", "MARFIL",
        "AZULPETROLEO", "VINOTINTO", "TERRACOTA", "ROJOCARMESI", "COBALTO", "MAGENTA", "AMBAR",
        "TANGERINA", "TIERRA", "MADERA", "MOSTAZA", "AGUAMARINA", "GRISHUMO",
        "GRANATE", "NARANJAMANDARINA", "LADRILLO", "MORADOINTENSO",
        "OLIVACLARO", "CENIZA", "FUEGO", "CIELO", "AGAVE", "ARENA", "PIEL",
        "LAVA", "OCRE", "CACAO", "MALVA", "CANELA", "COCOA",
        "BARRO", "PASTEL", "VAINILLA", "VERDEHOJA", "AZULCIELO", "VERDEAMAZONAS",
        "MORADOBERENJENA", "ROSACHICLE", "PISTACHO", "TABACO", "AZAFRAN",
        "GRISAZULADO", "PERLA", "PALOROSA", "MORADOOSCURO", "VERDEJUNGLE", "GRISCLARO",
        "NIEVE", "BRONCEADO", "CHICLE", "PLOMO", "NUBE", "ESMERALDA",
        "AMATISTA", "GRAFITO", "CENIZAOSCURO", "TORMENTA", "ANTRACITA", "HUMOAZUL",
        "ZAFIRO", "LAPISLAZULI", "ALUMINIO", "GRISCARBON", "BERMEJO", "MANGOMADURO",
        "JADE", "TURMALINA", "CARMESI", "ROSADOPOLVO", "GRISRATON", "TURQUESAOSCURO",
        "ROJOFERRARI", "VERDEPRIMAVERA", "CIRUELA", "OPALO", "VERDELIMON", "PIZARRA",
        "MOSTAZAOSCURO", "LADRILLOSUAVE", "AZULARANDANO", "LILAOSCURO", "PLATAVIEJA", "MORADOMEDIO",
        "VERDEFLUORESCENTE", "AMARILLOFLUORESCENTE", "ROJOOSCURO", "VERDEHIERBA", "AZULCOBALTO",
        "ROSADONEON", "GRISACERO", "NARANJANEON", "LILAPASTEL", "VERDEBOSCOSO",
        "ROSAPASTEL", "VIOLETAOSCURO", "TERRACOTACLARO", "DORADOOSCURO", "TURQUESACLARO",
        "VERDEOLIVAOSCURO", "CIANOSCURO", "AZULCENIZA", "MORADONEON", "ROJOGRANADA"
    ];

    // Guardar los valores iniciales al cargar la página
    let valoresIniciales = {};

    // Función para guardar los valores iniciales
    function guardarValoresIniciales() {
        valoresIniciales.tipo_material = document.querySelector('[name="tipo_material"]').value;
        valoresIniciales.tamano = document.querySelector('[name="tamano"]').value;
        valoresIniciales.color = document.querySelector('[name="color"]').value;
    }

    // Función para manejar la visibilidad de los campos color y factor de contracción
    function manejarVisibilidadCampos() {
        const tipoMaterial = document.querySelector('[name="tipo_material"]').value;
        const colorField = document.querySelector('[name="color"]').closest('.form-group');
        const factorContraccionField = document.querySelector('[name="factor_contraccion"]').closest('.form-group');

        // Ocultar el campo color si el material es CR CB o TITAN
        if (tipoMaterial === "CRCO" || tipoMaterial === "TITAN" || tipoMaterial === 'PEEK' || tipoMaterial === 'WAX') {
            colorField.style.display = 'none';
        } else {
            colorField.style.display = 'block';
        }

        // Ocultar el campo factor de contracción si el material no es de los especificados
        const materialesConFactor = ["3D", "SAGEMAX", "STC", "SHTC", "SHTM", "HTW", "AIZIR", "VEZNEER"];
        if (materialesConFactor.includes(tipoMaterial)) {
            factorContraccionField.style.display = 'block';
        } else {
            factorContraccionField.style.display = 'none';
        }
    }

    // Función para generar un nombre para el bloque al editar
    function generarNombreBloqueEditar() {
        // Obtener los valores del formulario
        const tipo_material = document.querySelector('[name="tipo_material"]').value.toUpperCase();
        const tamano = document.querySelector('[name="tamano"]').value.toUpperCase();
        const color = document.querySelector('[name="color"]').value.toUpperCase();
        const nombreInput = document.getElementById("nombre");
        const nombreActual = nombreInput.value.trim();

        console.log(nombreActual)
        // Dividir el nombre por espacios
        const partes = nombreActual.split(" ");

        // Extraer partes existentes
        const fruta = partes[1] || "";
        const colorAleatorio = partes[2] || "";
        const colorVita = partes.length === 5 ? partes[3] : ""; // si hay color vita
        const altura = partes[partes.length - 1] || "";

        // Construir nuevo nombre
        let nuevoNombre = "";

        // Usar color solo si el tipo_material no es CrCo, Titan, Peek o Wax
        if (["CRCO", "TITAN", "PEEK", "WAX"].includes(tipo_material)) {
            nuevoNombre = `${tipo_material} ${fruta} ${colorAleatorio} H${tamano}`;
        } else {
            nuevoNombre = `${tipo_material} ${fruta} ${colorAleatorio} ${color} H${tamano}`;
        }

        document.getElementById("nombre").value = nuevoNombre;
    }

    // Llamar a la función cuando se cargue la página
    document.addEventListener("DOMContentLoaded", function () {
        guardarValoresIniciales();
        manejarVisibilidadCampos();

        // Escuchar cambios en los campos relevantes
        document.querySelector('[name="tipo_material"]').addEventListener("input", () => {
            manejarVisibilidadCampos();
            generarNombreBloqueEditar();
        });

        document.querySelector('[name="color"]').addEventListener("input", generarNombreBloqueEditar);
        document.querySelector('[name="tamano"]').addEventListener("input", generarNombreBloqueEditar);
    });

    // Manejar el envío del formulario para asignar null al color si es necesario
    const form = document.querySelector('form');
    form.addEventListener('submit', (e) => {
        const tipoMaterial = document.querySelector('[name="tipo_material"]').value;
        const colorField = document.querySelector('[name="color"]');

        if (tipoMaterial === 'TITAN' || tipoMaterial === 'CRCO' || tipoMaterial === 'PEEK' || tipoMaterial === 'WAX') {
            colorField.value = '-'; // Asigna un valor alternativo en lugar de NULL
        }

        // Lista de materiales que requieren factor de contracción
        const materialesConFactor = ["3D", "SAGEMAX", "STC", "SHTC", "SHTM", "HTW", "AIZIR", "VEZNEER"];

        // Asignar "-" al factor de contracción si el material NO requiere este campo
        if (!materialesConFactor.includes(tipoMaterial)) {
            factorContraccionField.value = '-';
        }
    });
</script>